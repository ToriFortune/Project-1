define(["require","core/media-size-v2","jquery"],function(t){"use strict";var s=t("core/media-size-v2"),a=function(t,s){this.$el=t,this.app=s},e=t("jquery");return a.prototype={ERROR_MESSAGE_DURATION:5e3,constructor:a,start:function(){this.statusBar=this.$el.find(".js-player-status"),this.errorStatusBar=this.$el.find(".js-player-error"),this.errorStatusMessage=this.$el.find(".js-player-error-message"),this.setStatusMessage("inactive"),this.app.eventMediator.subscribe("player.track.playing",this.showPlayingStatus.bind(this)),this.app.eventMediator.subscribe("player.track.stopped",this.disable.bind(this)),this.app.eventMediator.subscribe("player.track.finished",this.disable.bind(this)),this.app.eventMediator.subscribe("player.ad.playing",this.adPlaying.bind(this)),this.app.eventMediator.subscribe("player.spotify.initialising",this.setStatusMessage.bind(this,"loading-spotify")),this.app.eventMediator.subscribe("player.spotify.abort",this.setStatusMessage.bind(this,"inactive")),this.app.eventMediator.subscribe("player.spotify.signup.start",this.setStatusMessage.bind(this,"spotify-signup")),this.app.eventMediator.subscribe("player.spotify.signup.end",this.setStatusMessage.bind(this,"inactive")),this.app.eventMediator.subscribe("player.spotify.error.auth-error",this.setStatusMessage.bind(this,"spotify-auth-error")),this.app.eventMediator.subscribe("player.playlist.request.error",this.setErrorMessage.bind(this,"cannot-play-item")),this.app.eventMediator.subscribe("player.track.unavailable",this.setErrorMessage.bind(this,"track-unavailable"))},showPlayingStatus:function(t){var s=e("<a />").addClass("player-bar-artist-name").attr("href",t.artistUrl).text(t.artistName),a=e("<a></a>").addClass("player-bar-track-name").attr("href",t.trackUrl).text(t.trackName);this.statusBar.html(a.prop("outerHTML")+s.prop("outerHTML")),this.statusBar.attr("title",t.trackName+" â€” "+t.artistName)},disable:function(){this.setStatusMessage("inactive")},adPlaying:function(){this.setStatusMessage("ad-playing")},setStatusMessage:function(t){var s=this.$el.data("player-status-"+t);this.setStatus(s)},setStatus:function(t){this.statusBar.html(t),this.statusBar.attr("title",this.statusBar.text())},setErrorMessage:function(t){var a=this.$el.data("player-error-"+t);if(s.isMobile()){var e=this.$el.data("player-modal-title"),i='<p data-modal-type="compact-narrow">'+a+"</p>";this.app.modal.show(e,i)}else clearTimeout(this.errorMessageTimeout),this.errorStatusBar.removeClass("player-bar-status--hide"),this.errorStatusMessage.text(a),this.errorStatusMessage.attr("title",a),this.statusBar.addClass("player-bar-status--hide"),this.errorMessageTimeout=setTimeout(function(){this.errorStatusBar.addClass("player-bar-status--hide"),this.statusBar.removeClass("player-bar-status--hide")}.bind(this),this.ERROR_MESSAGE_DURATION)}},a});